version: 2

models:
  - name: int_reservations
    description: "Aggregates reservation data from calendar entries."
    columns:
      - name: reservation_surrogate_key
        description: "A unique surrogate key for each reservation, generated from reservation_id and listing_id."
        tests:
          - unique
          - not_null      
      - name: reservation_id
        description: "Unique identifier for the reservation."
      - name: listing_id
        description: "Identifier of the listing associated with the reservation."
        tests:
          - not_null
          - relationships:
              to: ref('stg_listings')
              field: listing_id
      - name: reservation_start_date
        description: "The earliest date included in the reservation."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: "<= reservation_end_date"
      - name: reservation_end_date
        description: "The latest date included in the reservation."
        tests:
          - not_null
      - name: reservation_duration_days
        description: "Total number of days in the reservation (inclusive)."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 1"
      - name: total_reservation_price
        description: "Total price for the entire reservation period."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: applicable_minimum_nights
        description: "The most restrictive minimum nights requirement during the reservation period."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: "<= applicable_maximum_nights"
      - name: applicable_maximum_nights
        description: "The least restrictive maximum nights allowed during the reservation period."
        tests:
          - not_null
      - name: is_duration_within_limits
        description: "Indicates if the reservation duration is within the applicable minimum and maximum nights."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: "= true"
              config:
                severity: warn