version: 2

models:
  - name: stg_calendar
    description: "Transformed daily calendar availability and pricing data for listings."
    columns:
      - name: calendar_day_surrogate_key
        description: "A unique surrogate key for each calendar day entry, derived from listing_id, reservation_id, and date."
        tests:
          - unique
          - not_null
      - name: listing_id
        description: "Unique identifier for the listing."
        tests:
          - not_null
          - relationships:
              to: ref('stg_listings') 
              field: listing_id
      - name: calendar_date
        description: "Specific date for the availability record."
        tests:
          - not_null

      - name: is_available
        description: "Boolean indicating if the listing is available on the calendar_date."
        tests:
          - not_null

      - name: reservation_id
        description: "Identifier for a reservation, if the listing is booked."

      - name: price_per_night_calendar
        description: "Price per night for the listing on this specific date."
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0" 
      - name: minimum_nights
        description: "Minimum nights required for booking on this date."
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 1" 
      - name: maximum_nights
        description: "Maximum nights allowed for booking on this date."
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= minimum_nights"